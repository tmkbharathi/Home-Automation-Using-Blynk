# Home Automation with Blynk and PicSimLab

This project implements a smart home automation system using an Arduino UNO, controllable via the Blynk IoT App and simulated on PicSimLab. It features:
- Garden Light control based on ambient light (LDR)
- Temperature monitoring with automatic heater control
- Water level monitoring with automatic inlet/outlet control

## Setup Instructions for PicSimLab

To run this project in simulation, you need to configure PicSimLab with the correct board and spare parts.

1. **Open PicSimLab** and set the Board to **Arduino UNO**.
2. **Load the Hex File**: Go to `File -> Load Hex` and select the `.hex` file generated by the Makefile (typically in `build/`).
3. **Configure the Spare Parts Window**:
   Open `Modules -> Spare Parts` and add the following components. Wire them exactly as listed below:
   
   - **LDR Sensor (Light)**: Connect `A0` on the sensor to Analog Pin **A1** (for Garden light brightness control). *Leave D0 and Vth blank.*
   - **LED (Garden Light)**: Connect to Digital Pin **3** (PWM pin to control brightness).
   - **Temperature System (or LM35)**: 
      - Heater: Connect to Digital Pin **5**.
      - Cooler: Connect to Digital Pin **4**.
      - Temperature Sensor (`Vout` or LM35): Connect to Analog Pin **A0**.
   - **Serial Tank**: This is handled via Serial communication (UART). No external pins need to be wired.
   - **LCD 16x2 (I2C)**: Connect to the I2C pins.
      - SDA: **A4**
      - SCL: **A5**
      - *Note: Leave A0, A1, and A2 pins on the LCD blank (they default to address 0x27).*
   - **Ethernet Options**:
      - **Easy Way:** Add `Shield Ethernet W5500` from the Shields menu (no wiring needed).
      - **Manual Way:** Add `Ethernet W5500` from the standard list and wire `CS` -> 10, `MOSI` -> 11, `MISO` -> 12, `SCK` -> 13.

### 4. Setting up the Serial Tank (Virtual Serial Port)

The Serial Tank simulator requires a "virtual serial cable" to connect the Arduino (in PicSimLab) to the Tank UI.

1. **Install a Virtual COM Port Emulator**: Download and install a free tool like **com0com** or **Virtual Serial Port Emulator (VSPE)** on your Windows machine.
2. **Create a Port Pair**: Use the tool to create a linked pair of virtual COM ports (e.g., `COM1` and `COM2`).
3. **Configure PicSimLab (Arduino)**:
   - In the main PicSimLab window, go to `Options -> Serial`.
   - Set the Port to the first half of your pair (e.g., `COM1`).
   - Set the Baud Rate to `19200` (8N1).
4. **Configure the Serial Tank UI**:
   - In the Spare Parts window, go to `File -> Load` and select `Serial Tank`.
   - In the Serial Tank's settings, set its Port to the other half of your pair (e.g., `COM2`).
   - Set its Baud Rate to `19200`.

### 5. Connect to the Internet (Blynk Cloud)
PicSimLab simulation needs to bridge to your computer's actual internet to communicate with the Blynk server.
   - **Windows Users:** You must install [Npcap](https://npcap.com/) or WinPcap for this to work.
   - Go to `Options -> Ethernet` (or Network) in PicSimLab.
   - In the **Interface** dropdown, select your host computer's active network adapter (e.g., your actual physical Wi-Fi or Ethernet card). 
   - Ensure the MAC Address matches what is in the code (default is `DE:AD:BE:EF:FE:ED`).
   - The code will attempt to connect via DHCP first. If DHCP fails, it falls back to a static IP (`192.168.1.100`).

*(Note: The old method of using a Python script/bridge on a COM port is no longer required with the W5500 direct Ethernet simulation).*

---

## Setup Instructions for Blynk IoT App

To control and monitor this system remotely, set up a template in your Blynk IoT Web Dashboard and App.

### 1. Web Dashboard (Template Creation)
1. Go to [Blynk Console](https://blynk.cloud) and create a new **Template**.
   - **Name**: Home automation
   - **Hardware**: Arduino UNO
   - **Connection Type**: Ethernet (or WiFi depending on your PicSimLab bridge)
2. Note down the **Template ID**, **Device Name**, and **Auth Token**. Update these at the top of the `home_automation_blynk_controlled.ino` file.

### 2. Datastreams Configuration
Create the following Datastreams in your Blynk Template under the **Datastreams** tab by clicking `New Datastream -> Virtual Pin`:

| Component / Function | Virtual Pin | Data Type | Min / Max | Description                       |
|----------------------|-------------|-----------|-----------|-----------------------------------|
| Cooler Control       | **V0**      | Integer   | 0 / 1     | Button to toggle cooler ON/OFF    |
| Temperature Gauge    | **V1**      | Double    | 0 / 100   | Gauge to display Temperature (Â°C) |
| Heater Control       | **V2**      | Integer   | 0 / 1     | Button to toggle heater ON/OFF    |
| Water Volume Gauge   | **V3**      | Integer   | 0 / 3000  | Gauge to display water volume (L) |
| Inlet Valve Control  | **V4**      | Integer   | 0 / 1     | Button to toggle Inlet ON/OFF     |
| Outlet Valve Control | **V5**      | Integer   | 0 / 1     | Button to toggle Outlet ON/OFF    |
| Terminal             | **V6**      | String    | N/A       | Terminal widget for text logs     |

### 3. Mobile App Dashboard Setup
Open the Blynk IoT app on your phone, navigate to your device, and add the following widgets connecting them to the respective Datastreams:

- **2x Button Widgets**: For Cooler (`V0`) and Heater (`V2`). Set Mode to 'Switch'.
- **2x Button Widgets**: For Inlet Valve (`V4`) and Outlet Valve (`V5`). Set Mode to 'Switch'.
- **2x Gauge Widgets**: For Temperature (`V1` - max 100) and Water Volume (`V3` - max 3000).
- **1x Terminal Widget**: For system notifications (`V6`).

## Running the Project
1. Compile the code using `make all`.
2. Upload the hex file to PicSimLab.
3. Open the Blynk App and start interacting with the buttons to see the simulated system respond in the PicSimLab Spare Parts window!
